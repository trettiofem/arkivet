// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  username          String     @unique
  name              String
  program           String
  year              Int
  profilePictureURL String
  resources         Resource[]
  comments          Comment[]
  taggedIn          Tag[]
}

model Resource {
  ID            String       @unique
  owner         User         @relation(fields: [ownerUsername], references: [username])
  ownerUsername String
  type          ResourceType
  path          String
  permanentURL  String
  thumbnailURL  String
  size          BigInt
  name          String?
  unsorted      Boolean
  nsfw          Boolean
  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt
  userTags      Tag[]
  comments      Comment[]
}

enum ResourceType {
  IMAGE
  VIDEO
  POSTER
  PATCH
  MAGAZINE
  FILE
  SONG
  OTHER
}

model Comment {
  ID             String    @unique
  resource       Resource? @relation(fields: [resourceID], references: [ID])
  resourceID     String?
  author         User      @relation(fields: [authorUsername], references: [username])
  authorUsername String
  text           String
  createdAt      DateTime  @default(now())
}

model Tag {
  ID             String    @unique
  resource       Resource? @relation(fields: [resourceID], references: [ID])
  resourceID     String?
  tagged         User      @relation(fields: [taggedUsername], references: [username])
  taggedUsername String

  // For use with images specifically
  useFloatingTag Boolean @default(false)
  top            Decimal @default(0)
  left           Decimal @default(0)
  width          Decimal @default(0)
  height         Decimal @default(0)
}
